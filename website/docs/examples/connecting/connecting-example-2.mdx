---
id: example-2-connecting-to-snowflake
title: "Key Pair Authentication"
---

Key pair authentication is one of Snowflake's recommended authentication methods. It eliminates passwords entirely and provides better security.

## Documentation

- [Key-pair authentication and key-pair rotation](https://docs.snowflake.com/en/user-guide/key-pair-auth)
- [Snowflake SDK documentation](https://docs.snowflake.com/en/developer-guide/node-js/nodejs-driver-authenticate#use-key-pair-authentication-and-key-pair-rotation)
- [Troubleshooting guide](https://community.snowflake.com/s/article/Key-Based-Authentication-Failed-with-JWT-token-is-invalid-Error)


## Prerequisites

- A Snowflake user configured with key pair authentication
- Access to the private key file (store securely using AWS Secrets Manager, Azure Key Vault, etc.)

## Steps

1. Load your private key securely.
2. Create a connection with:
    - `authenticator: "SNOWFLAKE_JWT"`
    - `privateKey: <your-private-key>`
3. Pass the connection to `promisifyConnection`.
4. Call `connect()` to establish the connection.

## Example

```typescript
import * as crypto from "node:crypto";
import * as fs from "node:fs/promises";
import { promisifyConnection } from "snowflake-promise";
import snowflake from "snowflake-sdk";

// Get the PEM-formatted private key string from secure storage
// Replace `getFromSecureStorage` with your actual secure storage function
// (AWS Secrets Manager, Azure Key Vault, etc.)
const privateKey = await getFromSecureStorage("snowflake-private-key");

// Alternative: Read from filesystem (for development/testing only)
// const privateKeyFile = await fs.readFile("/path/to/your/rsa_key.p8");
// const privateKeyObject = crypto.createPrivateKey({
//   key: privateKeyFile,
//   format: "pem"
// });
// const privateKey = privateKeyObject.export({
//   format: "pem",
//   type: "pkcs8"
// });

const connection = promisifyConnection(
  snowflake.createConnection({
    account: "your-account",
    username: "your-username",
    authenticator: "SNOWFLAKE_JWT",
    privateKey: privateKey,
    // Optional: specify database, schema, warehouse
  })
);

try {
  await connection.connect();
  console.log("Successfully connected to Snowflake");
} catch (error) {
  console.error("Connection failed:", error);
  return;
}

// Now you can execute queries
// const { resultsPromise } = connection.execute({ sqlText: "SELECT 1" });
```
